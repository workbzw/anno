# 钱包连接问题排查指南

## 常见错误及解决方案

### 1. 错误码 -32002: "Already processing eth_requestAccounts"

**问题描述**：
- 错误信息：`Already processing eth_requestAccounts. Please wait.`
- 原因：MetaMask正在处理连接请求，收到了重复的连接请求

**解决方案**：
1. **等待当前请求完成**：不要快速重复点击"连接钱包"按钮
2. **关闭MetaMask弹窗**：如果有未处理的MetaMask弹窗，先关闭它
3. **刷新页面**：如果问题持续，刷新页面重新开始
4. **重启浏览器**：极端情况下重启浏览器

### 2. 错误码 4001: "User rejected the request"

**问题描述**：
- 用户在MetaMask弹窗中点击了"取消"或"拒绝"

**解决方案**：
1. 重新点击"连接钱包"
2. 在MetaMask弹窗中点击"连接"按钮

### 3. 错误码 -32603: "Internal JSON-RPC error"

**问题描述**：
- MetaMask内部错误

**解决方案**：
1. 检查MetaMask是否需要更新
2. 重启浏览器
3. 重新安装MetaMask扩展

## 最佳实践

### 连接钱包时：
1. ✅ 确保MetaMask已安装并解锁
2. ✅ 只点击一次"连接钱包"按钮
3. ✅ 等待MetaMask弹窗出现
4. ✅ 在弹窗中选择要连接的账户
5. ✅ 点击"连接"确认

### 避免问题：
1. ❌ 不要快速重复点击连接按钮
2. ❌ 不要在有待处理请求时发起新请求
3. ❌ 不要忽略MetaMask弹窗
4. ❌ 不要在MetaMask锁定时尝试连接

## 技术改进

我们已经在代码中添加了以下改进：

1. **防重复请求**：添加请求锁，防止并发连接请求
2. **智能错误处理**：针对不同错误码提供具体的错误信息
3. **状态检查**：连接前检查MetaMask状态
4. **用户友好提示**：提供清晰的错误信息和解决建议

## 支持的浏览器

- ✅ Chrome/Chromium
- ✅ Firefox
- ✅ Edge
- ✅ Brave
- ⚠️ Safari（部分功能可能受限）

## 联系支持

如果问题持续存在，请：
1. 检查浏览器控制台错误信息
2. 确认MetaMask版本
3. 提供详细的错误截图